import sys
import os
from datetime import datetime

# Add the project root to the Python path
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), 'app')))

from shared.llm.service import ask_whisky_info_to_llm
from features.whisky.service import save_whisky_info_to_firestore

# Provided text
text_data = """이번주에 신제품 소식이 들려와서 마트에 들렀는데요. 위스키 가격이 어떻게 바뀌었는지 빠르게 내용을 살펴보겠습니다. 가장 먼저 눈에 들어오는 제품은 바로 로야살루트 21년 그레인인데요. 이 위스키는 작년 9월에 249,800원에 판매되었으나 지난 연말에 21년 4,400원으로 35,400원 떨어져서 재고떨이 되었었는데 이번에 방문하니 판매 가격 199,800원으로 14,600원 더 내려가면서 재이코 되었습니다. 현재 가격인 199,800원은 1년인의 최고 가격인 249,800원에서 5만원 떨어졌을 뿐만 아니라 중국산 제품의 잔이긴 하지만 4개의 잔이 포함된 잔세트 제품이 다시 입고되어서 관심있는 분들을 마트에 들리시길 바랄게요. 같은 라인업의 다른 제품들을 살펴보면 21년 블렌디드 700ml 제품이 1년인의 최고 가격인 274,800원을 그대로 유지되고 있었고 21년 몰트 700ml 제품이 229,400원으로 지난 3월에 판매했었던 239,800원에서 14,000원 떨어져서 판매되고 있었네요. 같은 회사의 페르노리카의 블렌디드 제품들은 발렌타인 21년 224,800원, 17년 124,800원, 최고가격 66,800원에서 26,860원 떨어져 39,940원에 재고떨이하고 있는 마스터즈, 그리고 발렌타인 10년이 31,980원으로 지난주와 가격변동이 없었는데, 제임슨 스탠다드는 오히려 가격이 올라갔습니다. 지난주 가격이었던 28,480원에서 5,500원 인상된 33,980원으로 판매 중이었는데 현재 가격인 33,980원은 2년인의 최고 가격인 33,480원 보다 500원 더 비싼 금액이라서 역대 최고 가격을 갱신하였네요. 윌리엄 그랜트 앤 선즈 제품들도 가격이 인하하였습니다. 바로 발베니와 글램피딕인데요. 글램피딕 12년 500ml 제품이 판매가격 49,940원으로 59,800원에서 9860원 인하되었습니다. 500ml 용량에 49,940원은 일반적인 스카치 위스키 용량인 700ml로 환산하면 69,910원으로 계산되는데요. 이 가격은 현재 79,400원에 진열되어 있는 글램피딕 12년 700ml 제품보다 9490원 더 저렴하오니 이 위스키를 구입하실 분들은 700ml 제품보다는 500ml 제품을 구입하는 것이 더 합리적입니다. 이 라인업에 다른 제품들은 슬로바키아의 레망글라스가 2개 포함된 글램피딕 15년 잔세트 제품이 119,800원, 12년 제품이 79,400원으로 지난주와 가격변동이 없었네요. 이 회사의 다른 싱글몰트 라인업인 발베니 제품도 가격이 인하하였는데요. 바로 발베니 25년 레어메리지인데요. 이 제품은 작년 7월에 129만 8천원에 입고되었지만 지난주에 119만 8천원으로 10만원 인하되었었는데 이번에 방문하니 119만 4천원으로 10만 4천원 더 떨어졌습니다. 이 라인업의 다른 제품들은 12년 더브르드 98,800원, 16년 프렌치 호크가 264,800원에서 15,400원 내려간 249,400원으로 판매 중이어서 윌리엄 그랜트 앤 선즈의 제품들은 가격이 점점 내려가는 추세를 보여주고 있네요. 빔 산돌이의 제품들도 가격이 계속 떨어지고 있습니다. 2년 동안 가격변동이 없었던 메이커스 마크가 지난 4월에 54,800원에서 49,400원으로 5,400원 인하된 것을 시작으로 산돌이 각국인 가격 또한 가격이 내려갔는데요. 지난주 방문했을 때 가격이었던 34,980원에서 3,000원 인하된 31,980원으로 판매하고 있었습니다. 이 제품의 1년인의 최고 가격은 35,980원이고 최저 가격은 29,980원인데요. 현재 판매하는 31,980원의 가격은 최저 가격인 29,980원보다 2,000원 더 비싸기 때문에 하이볼 시즌이 오기 전에 3만원 이하로 떨어지길 기대합니다. 재고털이에 들어간 제품도 보이는데요. 바로 듀얼스 화이트라벨 제품입니다. 이 위스키는 작년 8월에 23,980원에 입구한 후 작년 연말에 판매 가격 24,980원으로 1,000원 올랐는데요. 지난주에 21,940원으로 3,040원 떨어졌고, 이번에 방문한이 판매 가격 19,940원으로 2,000원 더 인하되었습니다. 현재 판매 가격이 19,940원은 1년인의 최고 가격인 24,980원보다 5,040원 떨어진 금액으로 20%의 하락률을 보여주는데요. 가격표의 검은색 마름모가 표기된 것으로 보아 재고털이 단계에 들어가는 듯 보입니다. 재고털이 단계에 들어간 제품이 또 있는데요. 바로 싱글톤 더프타운 12년입니다. 작년 1월에 15년이 10만4,800원에서 35,400원 내려간 69,400원으로 재고털이를 하면서 이 제품도 62,800원에서 49,640원으로 13,160원 떨어지면서 재고털이를 했는데요. 올해 2월에 49,640원보다 3,660원 더 낮은 45,980원으로 1년 만에 재고되었지만 지난 4월에 판매 가격 44,940원으로 1,040원 떨어지면서 핫디 표시가 붙었습니다. 이번에 방문한이 44,940원에서 39,940원으로 5,000원 인하되면서 가격표의 검은색 마름모가 표기되었고, 가격의 끝자리가 40원으로 끝나는 것으로 보아 재고털이 단계에 들어가는 듯 보였네요. 같은 디아지오 회사의 싱글몰트 제품인 살리스컵 포트리도 가격이 떨어졌습니다. 이 제품은 올해 3월에 입고되어 지난주까지 72,800원에 판매되었으나 이번에 방문한이 69,800원으로 3,000원 인하되었는데요. 현재 판매하고 있는 69,800원의 가격은 작년 코스트코에서 판매했던 99,900원에 비하여 3만 100원 더 저렴한 가격이긴 하지만, 트레이더스에서 살리스컵 10년을 제외한 나머지 제품으로 거의 힘을 쓰지 못하고 있습니다. 2년 전에 입고되었던 와일더스의 팔리 에디션이 124,800원에서 55,400원 떨어진 69,400원으로 스톰이 92,800원에서 33,000원 내려간 99,800원으로 스카이가 65,800원에서 16,460원 인하된 49,340원으로 재고떨이를 했었는데 올해 3월에 입고된 포트리 또한 조만간 재고떨이를 하지 않을까 조심스럽게 예상되네요. 같은 회사의 존이워커 시리즈는 가격할인이 진행되고 있습니다. 골드리저브가 5월 5일부터 5월 18일까지 64,800원에서 5천원 할인하여 59,800원에 18년이 119,400원에서 20,000원 할인하여 99,400원에 진열되어 있는데요. 같은 라인업의 다른 제품들은 블론드 29,980원, 블랙 오징어 게임 39,940원, 블랙라벨 49,980원, 블랙루비 59,800원, 그린 라벨 69,800원, 엑사리 21년 159,800원, 블루 라벨 289,800원으로 지난주와 같은 가격을 유지하고 있었습니다. 자, 정리를 하자면 이 스킨 끼가 식어가면서 재고떨이나 가격이 인하된 제품들이 많이 보이는데요. 그 와중에 가성비 좋은 제품들을 영상으로 많이 소개해 드릴테니 구독자분들의 취미생활에 약간의 도움이 되시길 바랍니다. 이번 영상은 여기까지고요. 오늘의 트레이더스 위스키 영상이 좋으셨다면 구독과 좋아요, 채널가입까지 부탁드립니다. 고맙습니다."""

# Current date is July 2025
current_year = 2025
current_month = 7

print(f"Processing whisky data for {current_year}-{current_month:02d}...")

# 1. Extract whisky information using LLM
# The description can be empty or a summary of the text if needed
whisky_infos = ask_whisky_info_to_llm(
    text=text_data,
    year=current_year,
    month=current_month,
    description="위스키 가격 변동 및 신제품 정보"
)

# 2. Save extracted information to Firestore
if whisky_infos:
    print(f"Extracted {len(whisky_infos)} whisky items. Saving to Firestore...")
    save_whisky_info_to_firestore(whisky_infos)
    print("Successfully saved whisky information to Firestore.")
else:
    print("No whisky information extracted.")

print("Processing complete.")
